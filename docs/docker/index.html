<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; 
font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com https://public.slidesharecdn.com  https://cdn.jsdelivr.net jsdelivr.net jsdelivr.net disqus.com disquscdn.com *.disqus.com *.disquscdn.com; 
form-action 'self' https://syndication.twitter.com/ https://platform.twitter.com disqus.com disquscdn.com *.disqus.com *.disquscdn.com; 
frame-src 'self' https://cse.google.com https://player.vimeo.com www.youtube.com www.youtube-nocookie.com https://platform.twitter.com https://syndication.twitter.com jsfiddle.net www.instagram.com https://kuula.co https://www.slideshare.net https://www.google.com https://googleads.g.doubleclick.net disqus.com disquscdn.com *.disqus.com *.disquscdn.com; 
img-src 'self' https://jeremylikness.visualstudio.com https://www.google-analytics.com https://stats.g.doubleclick.net https://pagead2.googlesyndication.com *.google.com *.gstatic.com *.amazon-adsystem.com https://www.googleapis.com https://images-na.ssl-images-amazon.com https://platform.twitter.com *.twimg.com https://syndication.twitter.com data: https://files.kuula.io disqus.com disquscdn.com *.disqus.com *.disquscdn.com; 
object-src 'none'; 
style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://use.fontawesome.com https://fonts.googleapis.com https://www.google.com https://platform.twitter.com *.twimg.com disqus.com disquscdn.com *.disqus.com *.disquscdn.com; 
script-src 'self' 'unsafe-inline' https://gist.github.com https://platform.twitter.com https://cdn.syndication.twimg.com *.amazon-adsystem.com https://www.google-analytics.com https://cdn.jsdelivr.net cse.google.com https://www.google.com https://pagead2.googlesyndication.com https://adservice.google.com https://www.googletagservices.com jsfiddle.net www.instagram.com disqus.com disquscdn.com *.disqus.com *.disquscdn.com;">
<title>Docker | RTFM DevOps</title>


<link rel="stylesheet" href="/book.min.89885fa0429ec73067282f26fc0c6d38cfc617a443ec4e835d47b821c52c6e92.css" integrity="sha256-iYhfoEKexzBnKC8m/AxtOM/GF6RD7E6DXUe4IcUsbpI=">


<script defer src="/search.min.fed8d8e957a92d7218b4c27ba45900fc4945bc243dd85205891b70ba4b693bad.js" integrity="sha256-/tjY6VepLXIYtMJ7pFkA/ElFvCQ92FIFiRtwuktpO60="></script>



<link rel="icon" href="/favicon.png" type="image/x-icon">


<link rel="alternate" type="application/rss+xml" href="https://rtfmdev.github.io/docs/docker/index.xml" title="RTFM DevOps" />
<!--
Made with rtfm template
https://github.com/denzalman/rtfm-template
-->
  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav>

<h2 class="book-brand">
  <a href="https://rtfmdev.github.io/"><img src="/rtfm.png" alt="Logo" /><span>RTFM DevOps</span>
  </a>
</h2>

<div class="book-search">
  <input type="text" placeholder="Search" id="book-search-input" maxlength="64" readonly />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>




    

  
  





 
  
    

  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/docker/"  class="active">
      Docker
  </a>


    

    

  <ul>
    
      
        <li>

  <a href="/docs/docker/commans/" >
      Cheatsheet
  </a>

</li>
      
    
  </ul>


  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/AWS/" >
      A W S
  </a>


    

    

  <ul>
    
      
        <li>

  <a href="/docs/AWS/useful-tips/" >
      Useful Tips
  </a>

</li>
      
    
  </ul>


  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/linux/" >
      Linux
  </a>


    

    

  <ul>
    
  </ul>


  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/dev-tools/" >
      Dev Tools
  </a>


    

    

  <ul>
    
      
        <li>

  <a href="/docs/dev-tools/git/" >
      Git Tricks
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/dev-tools/python/" >
      Python
  </a>

</li>
      
    
      
    
      
    
      
        <li>

  <a href="/docs/dev-tools/one-liners/" >
      Bash oneliners
  </a>

</li>
      
    
  </ul>


  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/miscellaneous/" >
      Miscellaneous
  </a>


    

    

  <ul>
    
      
        <li>

  <a href="/docs/miscellaneous/to-read/" >
      to Read
  </a>

</li>
      
    
  </ul>


  </li>


      
    
  </ul>


  









<a href ="/posts/">Blog</a></br></br>
<a href ="/DenSalmanovCVen.pdf">My CV</a>

</nav>


<script>
(function() {
  var menu = document.querySelector("aside.book-menu nav");
  addEventListener("beforeunload", function(event) {
    localStorage.setItem("menu.scrollTop", menu.scrollTop);
  });
  menu.scrollTop = localStorage.getItem("menu.scrollTop");
})();
</script>
    </aside>

    <div class="book-page">
      <header class="flex align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" alt="Menu" />
  </label>
  <strong>Docker</strong>
</header>
      
<article class="markdown">

<h1 id="docker">Docker</h1>

<h2 id="portainer">Portainer</h2>

<p><strong>Portainer</strong> - is very useful GUI for managing Docker&rsquo;s hosts and clusters. Simply open port 9000 on your host, run container and open in your browser host_ip:9000, create user and manage all your containers.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker container run -d <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -p <span style="color:#ae81ff">9000</span>:9000 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer</code></pre></div>
<h2 id="install-docker">Install Docker</h2>

<p>The Docker installation package available in the official Ubuntu repository may not be the latest version. To ensure we get the latest version, we’ll install Docker from the official Docker repository. To do that, we’ll add a new package source, add the GPG key from Docker to ensure the downloads are valid, and then install the package.</p>

<p>First, update your existing list of packages:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt update</code></pre></div>
<p>Next, install a few prerequisite packages which let apt use packages over HTTPS:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt install apt-transport-https ca-certificates curl software-properties-common</code></pre></div>
<p>Then add the GPG key for the official Docker repository to your system:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</code></pre></div>
<p>Add the Docker repository to APT sources:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo add-apt-repository <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span><span style="color:#e6db74">&#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable&#34;</span></code></pre></div>
<p>Next, update the package database with the Docker packages from the newly added repo and install Docker:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt update
sudo apt install docker-ce</code></pre></div>
<p>Docker should now be installed, the daemon started, and the process enabled to start on boot. Check that it’s running:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo systemctl status docker</code></pre></div>
<p>The output should be similar to the following, showing that the service is active and running:</p>

<p>Output</p>

<pre><code>● docker.service - Docker Application Container Engine
   Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)
   Active: active (running) since Thu 2018-07-05 15:08:39 UTC; 2min 55s ago
     Docs: https://docs.docker.com
 Main PID: 10096 (dockerd)
    Tasks: 16
   CGroup: /system.slice/docker.service
           ├─10096 /usr/bin/dockerd -H fd://
           └─10113 docker-containerd --config /var/run/docker/containerd/containerd.toml
</code></pre>

<p>Installing Docker now gives you not just the Docker service (daemon) but also the docker command line utility, or the Docker client.</p>

<p><strong>Understanding containers has to cover things like chroot, the container file system and layers, cgroup isolation, and talk about the pros/cons of containers.</strong></p>

<p>An explanation of how these work without a discussion of cgroups and how that facilitates process/memory/network isolation is going to sound weak to an interviewer. So read up on how cgroups are implemented in the kernel. Then learn about the different ways lxc containers work vs docker containers. Then learn about emerging container specification standards. Why are they happening? Understand what’s going on both under the hood in the kernel and the shifts happening in the industry.</p>

<h2 id="chroot">chroot</h2>

<p>A <em>chroot</em> environment provides functionality similar to that of a virtual machine, but it is a lighter solution. The captive system doesn’t need a hypervisor to be installed and configured, such as VirtualBox or Virtual Machine Manager. Nor does it need to have a kernel installed in the captive system. The captive system shares your existing kernel.</p>

<h3 id="creating-chroot-environment">Creating chroot environment</h3>

<p>We need a directory to act as the root directory of the chroot environment. So that we have a shorthand way of referring to that directory we’ll create a variable and store the name of the directory in it. Here we’re setting up a variable to store a path to the “testroot” directory. It doesn’t matter if this directory doesn’t exist yet, we’re going to create it soon. If the directory does exist, it should be empty.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">chr<span style="color:#f92672">=</span>/home/dave/testroot
mkdir -p $chr</code></pre></div>
<p>We need to create directories to hold the portions of the operating system our <em>chroot</em> environment will require. We’re going to set up a minimalist Linux environment that uses Bash as the interactive shell. We’ll also include the touch, rm, and ls commands. That will allow us to use all Bash’s built-in commands and touch, rm, and ls. We’ll be able to create, list and remove files, and use Bash. And—in this simple example—that’s all.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir -p $chr/<span style="color:#f92672">{</span>bin,lib,lib64<span style="color:#f92672">}</span>

cd $chr</code></pre></div>
<p>Let’s copy the binaries that we need in our minimalist Linux environment from your regular “/bin” directory into our chroot “/bin” directory. The -v (verbose) option makes cp tell us what it is doing as it performs each copy action.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cp -v /bin/<span style="color:#f92672">{</span>bash,touch,ls,rm<span style="color:#f92672">}</span> $chr</code></pre></div>
<h3 id="dependencies">Dependencies</h3>

<p>These binaries will have dependencies. We need to discover what they are and copy those files into our environment. This way, for example we can add all dependencies for /bin/bash:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">list<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>ldd /bin/bash | egrep -o <span style="color:#e6db74">&#39;/lib.*\.[0-9]&#39;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
<span style="color:#66d9ef">for</span> i in $list; <span style="color:#66d9ef">do</span> cp -v --parents <span style="color:#e6db74">&#34;</span>$i<span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>chr<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">done</span></code></pre></div>
<p>Use that technique to capture the dependencies of each of the other commands. Or you can write one more loop through all your apps.</p>

<h3 id="chroot-command">chroot command</h3>

<p>The last of our dependencies are copied into our chroot environment. We’re finally ready to use the chroot command. This command sets the root of the chroot environment, and specifies which application to run as the shell.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo chroot $chr /bin/bash</code></pre></div>
<p>Our chroot environment is now active. The terminal window prompt has changed, and the interactive shell is the being handled by the bash shell in our environment.</p>

<p>Use exit to leave the chroot environment:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">exit</code></pre></div></article>

      
      
    </div>

    
  

  <aside class="book-toc level-3 fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#docker">Docker</a>
<ul>
<li><a href="#portainer">Portainer</a></li>
<li><a href="#install-docker">Install Docker</a></li>
<li><a href="#chroot">chroot</a>
<ul>
<li><a href="#creating-chroot-environment">Creating chroot environment</a></li>
<li><a href="#dependencies">Dependencies</a></li>
<li><a href="#chroot-command">chroot command</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </aside>


  </main>

  
  
</body>

</html>