<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; 
font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com https://public.slidesharecdn.com  https://cdn.jsdelivr.net jsdelivr.net jsdelivr.net disqus.com disquscdn.com *.disqus.com *.disquscdn.com; 
form-action 'self' https://syndication.twitter.com/ https://platform.twitter.com disqus.com disquscdn.com *.disqus.com *.disquscdn.com; 
frame-src 'self' https://cse.google.com https://player.vimeo.com www.youtube.com www.youtube-nocookie.com https://platform.twitter.com https://syndication.twitter.com jsfiddle.net www.instagram.com https://kuula.co https://www.slideshare.net https://www.google.com https://googleads.g.doubleclick.net disqus.com disquscdn.com *.disqus.com *.disquscdn.com; 
img-src 'self' https://jeremylikness.visualstudio.com https://www.google-analytics.com https://stats.g.doubleclick.net https://pagead2.googlesyndication.com *.google.com *.gstatic.com *.amazon-adsystem.com https://www.googleapis.com https://images-na.ssl-images-amazon.com https://platform.twitter.com *.twimg.com https://syndication.twitter.com data: https://files.kuula.io disqus.com disquscdn.com *.disqus.com *.disquscdn.com; 
object-src 'none'; 
style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://use.fontawesome.com https://fonts.googleapis.com https://www.google.com https://platform.twitter.com *.twimg.com disqus.com disquscdn.com *.disqus.com *.disquscdn.com; 
script-src 'self' 'unsafe-inline' https://platform.twitter.com https://cdn.syndication.twimg.com *.amazon-adsystem.com https://www.google-analytics.com https://cdn.jsdelivr.net cse.google.com https://www.google.com https://pagead2.googlesyndication.com https://adservice.google.com https://www.googletagservices.com jsfiddle.net www.instagram.com disqus.com disquscdn.com *.disqus.com *.disquscdn.com;">
<title>Kubectl | RTFM DevOps</title>


<link rel="stylesheet" href="/book.min.89885fa0429ec73067282f26fc0c6d38cfc617a443ec4e835d47b821c52c6e92.css" integrity="sha256-iYhfoEKexzBnKC8m/AxtOM/GF6RD7E6DXUe4IcUsbpI=">


<script defer src="/search.min.a4c9a982effbed5f55b146bb2201db5c58cc46e925db6ad21c6af7e0178ac19c.js" integrity="sha256-pMmpgu/77V9VsUa7IgHbXFjMRukl22rSHGr34BeKwZw="></script>



<link rel="icon" href="/favicon.png" type="image/x-icon">


<!--
Made with rtfm template
https://github.com/denzalman/rtfm-template
-->
  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav>

<h2 class="book-brand">
  <a href="https://rtfmdev.github.io/"><img src="/rtfm.png" alt="Logo" /><span>RTFM DevOps</span>
  </a>
</h2>

<div class="book-search">
  <input type="text" placeholder="Search" id="book-search-input" maxlength="64" readonly />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>




    

  
  





 
  
    

  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/devops-tools/" >
      Devops Tools
  </a>


    

    

  <ul>
    
  </ul>


  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/AWS/" >
      A W S
  </a>


    

    

  <ul>
    
  </ul>


  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/kubernetes/" >
      Kubernetes
  </a>


    

    

  <ul>
    
      
        <li>

  <a href="/docs/kubernetes/kubectl/"  class="active">
      Kubectl
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/kubernetes/configMaps/" >
      Config Maps
  </a>

</li>
      
    
      
    
      
        <li>

  <a href="/docs/kubernetes/ingress/" >
      Ingress
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/kubernetes/volume_types/" >
      Volume Types
  </a>

</li>
      
    
  </ul>


  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/linux/" >
      Linux
  </a>


    

    

  <ul>
    
  </ul>


  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/miscellaneous/" >
      Miscellaneous
  </a>


    

    

  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/miscellaneous/examples/" >
      Examples
  </a>


    

    

  <ul>
    
      
        <li>

  <a href="/docs/miscellaneous/examples/test/" >
      Test
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/miscellaneous/examples/with-toc/" >
      With Table of Contents
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/miscellaneous/examples/without-toc/" >
      Without Table of Contents
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/miscellaneous/examples/shortcodes/" >
      Shortcodes
  </a>

</li>
      
    
  </ul>


  </li>


      
    
      
        <li>

  <a href="/docs/miscellaneous/server/" >
      Server
  </a>

</li>
      
    
  </ul>


  </li>


      
    
  </ul>


  









<a href ="/posts/">Blog</a>
</nav>


<script>
(function() {
  var menu = document.querySelector("aside.book-menu nav");
  addEventListener("beforeunload", function(event) {
    localStorage.setItem("menu.scrollTop", menu.scrollTop);
  });
  menu.scrollTop = localStorage.getItem("menu.scrollTop");
})();
</script>
    </aside>

    <div class="book-page">
      <header class="flex align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" alt="Menu" />
  </label>
  <strong>Kubectl</strong>
</header>
      
<article class="markdown">

<h1 id="kubectl-cheatsheet">kubectl cheatsheet</h1>

<h2 id="connection-details">Connection details</h2>

<p>To look at the connection details, we can either see the content of the <strong>~/.kube/config</strong> file (on Linux) or run the following command:</p>

<pre><code>$ kubectl config view
</code></pre>

<h2 id="cluster-info">Cluster info</h2>

<pre><code>kubectl cluster-info
</code></pre>

<p>When not using the kubectl proxy, we need to authenticate to the API server when sending API requests. We can authenticate by providing a Bearer Token when issuing a curl, or by providing a set of keys and certificates.</p>

<p>A Bearer Token is an access token which is generated by the authentication server (the API server on the master node) and given back to the client. Using that token, the client can connect back to the Kubernetes API server without providing further authentication details, and then, access resources.</p>

<h2 id="get-the-token">Get the token:</h2>

<pre><code>$ TOKEN=$(kubectl describe secret -n kube-system $(kubectl get secrets -n kube-system | grep default | cut -f1 -d ' ') | grep -E '^token' | cut -f2 -d':' | tr -d '\t' | tr -d &quot; &quot;)
</code></pre>

<h2 id="get-the-api-server-endpoint">Get the API server endpoint:</h2>

<pre><code>$ APISERVER=$(kubectl config view | grep https | cut -f 2- -d &quot;:&quot; | tr -d &quot; &quot;)
</code></pre>

<h2 id="access-the-api-server">Access the API server</h2>

<pre><code>$ curl $APISERVER --header &quot;Authorization: Bearer $TOKEN&quot; --insecure
</code></pre>

<p>Instead of the access token, we can extract the client certificate, client key, and certificate authority data from the .kube/config file. Once extracted, they are encoded and then passed with a curl command for authentication. The new curl command looks similar to:</p>

<pre><code>$ curl $APISERVER --cert encoded-cert --key encoded-key --cacert encoded-ca
</code></pre>

<h2 id="list-the-pods">List the Pods</h2>

<h4 id="along-with-their-attached-labels">Along with their attached Labels</h4>

<p>With the -L option to the kubectl get pods command, we add extra columns in the output to list Pods with their attached Label keys and their values. In the following example, we are listing Pods with the Label keys <em>k8s-app</em> and <em>label2</em>:</p>

<pre><code>$ kubectl get pods -L k8s-app,label2
NAME                        READY   STATUS    RESTARTS   AGE   K8S-APP     LABEL2
webserver-c8f4d5fbc-ggqkj   1/1     Running   0          16m   webserver
webserver-c8f4d5fbc-hmh2t   1/1     Running   0          16m   webserver
webserver-c8f4d5fbc-t2ntz   1/1     Running   0          16m   webserver
</code></pre>

<h4 id="pods-with-a-given-label">Pods with a given Label</h4>

<p>To use a selector with the kubectl get pods command, we can use the -l option. In the following example, we are selecting all the Pods that have the <em>k8s-app</em> Label key set to value <em>webserver</em>:</p>

<pre><code>$ kubectl get pods -l k8s-app=webserver
NAME                        READY   STATUS    RESTARTS   AGE
webserver-c8f4d5fbc-ggqkj   1/1     Running   0          23m
webserver-c8f4d5fbc-hmh2t   1/1     Running   0          24m
webserver-c8f4d5fbc-t2ntz   1/1     Running   0          23m
</code></pre>

<h2 id="look-at-a-pod-s-details">Look at a Pod&rsquo;s Details</h2>

<p>We can look at an object&rsquo;s details using kubectl describe command. In the following example, you can see a Pod&rsquo;s description:</p>

<pre><code>$ kubectl describe pod webserver-c8f4d5fbc-ggqkj
Name:         webserver-c8f4d5fbc-ggqkj
Namespace:    default
Priority:     0
Node:         minikube/10.0.2.15
Start Time:   Sat, 05 Oct 2019 14:37:34 +0300
Labels:       k8s-app=webserver
              pod-template-hash=c8f4d5fbc
Annotations:  &lt;none&gt;
Status:       Running
IP:           172.17.0.7
IPs:
  IP:           172.17.0.7
Controlled By:  ReplicaSet/webserver-c8f4d5fbc
Containers:
  webserver:
    Container ID:   docker://b7d6bd7ce9eaefe48523d486f7174ac748571546bec4d8674b89d4438c8707da
    Image:          nginx:alpine
    Image ID:       docker-pullable://nginx@sha256:77f340700d08fd45026823f44fc0010a5bd2237c2d049178b473cd2ad977d071
    Port:           &lt;none&gt;
    Host Port:      &lt;none&gt;
    State:          Running
      Started:      Sat, 05 Oct 2019 14:37:36 +0300
    Ready:          True
    Restart Count:  0
    Environment:    &lt;none&gt;
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-r6llk (ro)
Conditions:
  Type              Status
  Initialized       True
  Ready             True
  ContainersReady   True
  PodScheduled      True
Volumes:
  default-token-r6llk:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  default-token-r6llk
    Optional:    false
QoS Class:       BestEffort
Node-Selectors:  &lt;none&gt;
Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s
                 node.kubernetes.io/unreachable:NoExecute for 300s
Events:
  Type    Reason     Age        From               Message
  ----    ------     ----       ----               -------
  Normal  Scheduled  &lt;unknown&gt;  default-scheduler  Successfully assigned default/webserver-c8f4d5fbc-ggqkj to minikube
  Normal  Pulled     19m        kubelet, minikube  Container image &quot;nginx:alpine&quot; already present on machine
  Normal  Created    19m        kubelet, minikube  Created container webserver
  Normal  Started    19m        kubelet, minikube  Started container webserver
</code></pre>

<h2 id="exposing-an-application">Exposing an Application</h2>

<p>For a NodePort ServiceType, Kubernetes opens up a static port on all the worker nodes. If we connect to that port from any node, we are proxied to the ClusterIP of the Service. Next, let&rsquo;s use the NodePort ServiceType while creating a Service.</p>

<p>Create a webserver-svc.yaml file with the following content:</p>

<pre><code>apiVersion: v1
kind: Service
metadata:
  name: web-service
  labels:
    run: web-service
spec:
  type: NodePort
  ports:
  - port: 80
    protocol: TCP
  selector:
    app: nginx 
</code></pre>

<p>Using kubectl, create the Service:</p>

<pre><code>$ kubectl create -f webserver-svc.yaml
service/web-service created
</code></pre>

<p>A more direct method of creating a Service is by exposing the previously created Deployment (this method requires an existing Deployment).</p>

<p>Expose a Deployment with the kubectl expose command:</p>

<pre><code>$ kubectl expose deployment webserver --name=web-service --type=NodePort
service/web-service exposed
</code></pre>

<p>more kubectl commands and manuals is <a href="https://kubernetes.io/docs/reference/kubectl/overview/">here</a></p>
</article>
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "rtfmdev" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      
      
    </div>

    
  

  <aside class="book-toc level-3 fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#kubectl-cheatsheet">kubectl cheatsheet</a>
<ul>
<li><a href="#connection-details">Connection details</a></li>
<li><a href="#cluster-info">Cluster info</a></li>
<li><a href="#get-the-token">Get the token:</a></li>
<li><a href="#get-the-api-server-endpoint">Get the API server endpoint:</a></li>
<li><a href="#access-the-api-server">Access the API server</a></li>
<li><a href="#list-the-pods">List the Pods</a>
<ul>
<li>
<ul>
<li><a href="#along-with-their-attached-labels">Along with their attached Labels</a></li>
<li><a href="#pods-with-a-given-label">Pods with a given Label</a></li>
</ul></li>
</ul></li>
<li><a href="#look-at-a-pod-s-details">Look at a Pod&rsquo;s Details</a></li>
<li><a href="#exposing-an-application">Exposing an Application</a></li>
</ul></li>
</ul>
</nav>
  </aside>


  </main>

  
  
</body>

</html>